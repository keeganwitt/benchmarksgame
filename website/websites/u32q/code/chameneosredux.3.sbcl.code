<span class="hl slc">;; The Computer Language Benchmarks Game</span>
<span class="hl slc">;;   http://benchmarksgame.alioth.debian.org/</span>
<span class="hl slc">;;</span>
<span class="hl slc">;;   contributed by Alexey Voznyuk</span>
<span class="hl slc">;;</span>

<span class="hl opt">(</span><span class="hl kwa">defpackage</span> <span class="hl opt">#:</span>smp-utils
  <span class="hl opt">(:</span>use <span class="hl opt">:</span>cl <span class="hl opt">:</span>sb-alien <span class="hl opt">:</span>sb-thread<span class="hl opt">)</span>
  <span class="hl opt">(:</span>export <span class="hl opt">#:</span>affinity <span class="hl opt">#:</span>apic-core-map<span class="hl opt">))</span>

<span class="hl opt">(</span><span class="hl kwa">in-package</span> <span class="hl opt">:</span>smp-utils<span class="hl opt">)</span>

<span class="hl opt">(</span><span class="hl kwa">defun</span> cpuset-<span class="hl opt">&gt;</span>list <span class="hl opt">(</span><span class="hl kwa">cpuset</span><span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>for i <span class="hl opt">:</span>from <span class="hl num">0</span> <span class="hl opt">:</span>below <span class="hl num">128</span>
     <span class="hl opt">:</span>unless <span class="hl opt">(</span><span class="hl kwa">zerop</span> <span class="hl opt">(</span><span class="hl kwa">ldb</span> <span class="hl opt">(</span><span class="hl kwa">byte</span> <span class="hl num">1</span> <span class="hl opt">(</span><span class="hl kwa">mod</span> i <span class="hl num">8</span><span class="hl opt">)) (</span><span class="hl kwa">elt</span> cpuset <span class="hl opt">(</span><span class="hl kwa">truncate</span> i <span class="hl num">8</span><span class="hl opt">))))</span>
     <span class="hl opt">:</span>collect i<span class="hl opt">))</span>

<span class="hl opt">(</span><span class="hl kwa">defun</span> list-<span class="hl opt">&gt;</span>cpuset <span class="hl opt">(</span><span class="hl kwa">cpuset-list</span><span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>with cpuset <span class="hl opt">= (</span><span class="hl kwa">make-array</span> <span class="hl num">16</span> <span class="hl opt">:</span>element-type <span class="hl opt">'(</span><span class="hl kwa">unsigned-byte</span> <span class="hl num">8</span><span class="hl opt">))</span>
     <span class="hl opt">:</span>for i <span class="hl opt">:</span>from <span class="hl num">0</span> <span class="hl opt">:</span>below <span class="hl num">128</span>
     <span class="hl opt">:</span>when <span class="hl opt">(</span><span class="hl kwa">find</span> i cpuset-list <span class="hl opt">:</span>test <span class="hl opt">#'=)</span>
     <span class="hl opt">:</span>do <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">ldb</span> <span class="hl opt">(</span><span class="hl kwa">byte</span> <span class="hl num">1</span> <span class="hl opt">(</span><span class="hl kwa">mod</span> i <span class="hl num">8</span><span class="hl opt">)) (</span><span class="hl kwa">elt</span> cpuset <span class="hl opt">(</span><span class="hl kwa">truncate</span> i <span class="hl num">8</span><span class="hl opt">)))</span> <span class="hl num">1</span><span class="hl opt">)</span>
     <span class="hl opt">:</span>finally <span class="hl opt">(</span><span class="hl kwa">return</span> cpuset<span class="hl opt">)))</span>

<span class="hl opt">(</span><span class="hl kwa">defun</span> affinity <span class="hl opt">(</span><span class="hl kwa">thread</span><span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">with-alien</span> <span class="hl opt">((</span><span class="hl kwa">alien-cpuset</span> <span class="hl opt">(</span><span class="hl kwa">array</span> unsigned-char <span class="hl num">16</span><span class="hl opt">)))</span>
    <span class="hl opt">(</span><span class="hl kwa">let</span> <span class="hl opt">((</span><span class="hl kwa">retcode</span> <span class="hl opt">(</span><span class="hl kwa">alien-funcall</span> <span class="hl opt">(</span><span class="hl kwa">extern-alien</span> <span class="hl str">&quot;pthread_getaffinity_np&quot;</span> 
                                                <span class="hl opt">(</span><span class="hl kwa">function</span> int 
                                                          unsigned-long 
                                                          unsigned-long 
                                                          <span class="hl opt">(*</span> unsigned-char<span class="hl opt">)))</span>
                                  <span class="hl opt">(</span><span class="hl kwa">sb-thread</span><span class="hl opt">::</span>thread-os-thread thread<span class="hl opt">)</span>
                                  <span class="hl num">16</span>
                                  <span class="hl opt">(</span><span class="hl kwa">cast</span> alien-cpuset <span class="hl opt">(*</span> unsigned-char<span class="hl opt">)))))</span>
      <span class="hl opt">(</span><span class="hl kwa">when</span> <span class="hl opt">(</span><span class="hl kwa">zerop</span> retcode<span class="hl opt">)</span>
        <span class="hl opt">(</span><span class="hl kwa">values</span> t <span class="hl opt">(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>with cpuset <span class="hl opt">= (</span><span class="hl kwa">make-array</span> <span class="hl num">16</span> <span class="hl opt">:</span>element-type <span class="hl opt">'(</span><span class="hl kwa">unsigned-byte</span> <span class="hl num">8</span><span class="hl opt">))</span>
                     <span class="hl opt">:</span>for i <span class="hl opt">:</span>from <span class="hl num">0</span> <span class="hl opt">:</span>below <span class="hl num">16</span>
                     <span class="hl opt">:</span>do <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">elt</span> cpuset i<span class="hl opt">) (</span><span class="hl kwa">deref</span> alien-cpuset i<span class="hl opt">))</span>
                     <span class="hl opt">:</span>finally <span class="hl opt">(</span><span class="hl kwa">return</span> <span class="hl opt">(</span><span class="hl kwa">cpuset-</span><span class="hl opt">&gt;</span>list cpuset<span class="hl opt">))))))))</span>

<span class="hl opt">(</span><span class="hl kwa">defun</span> <span class="hl opt">(</span><span class="hl kwa">setf</span> affinity<span class="hl opt">) (</span><span class="hl kwa">affinity</span> thread<span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">with-alien</span> <span class="hl opt">((</span><span class="hl kwa">alien-cpuset</span> <span class="hl opt">(</span><span class="hl kwa">array</span> unsigned-char <span class="hl num">16</span><span class="hl opt">)))</span>
    <span class="hl opt">(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>with cpuset <span class="hl opt">= (</span><span class="hl kwa">list-</span><span class="hl opt">&gt;</span>cpuset affinity<span class="hl opt">)</span>
       <span class="hl opt">:</span>for i <span class="hl opt">:</span>from <span class="hl num">0</span> <span class="hl opt">:</span>below <span class="hl num">16</span>
       <span class="hl opt">:</span>do <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">deref</span> alien-cpuset i<span class="hl opt">) (</span><span class="hl kwa">elt</span> cpuset i<span class="hl opt">)))</span>
    <span class="hl opt">(</span><span class="hl kwa">zerop</span> <span class="hl opt">(</span><span class="hl kwa">alien-funcall</span> <span class="hl opt">(</span><span class="hl kwa">extern-alien</span> <span class="hl str">&quot;pthread_setaffinity_np&quot;</span> 
                                        <span class="hl opt">(</span><span class="hl kwa">function</span> int 
                                                  unsigned-long 
                                                  unsigned-long 
                                                  <span class="hl opt">(*</span> unsigned-char<span class="hl opt">)))</span>
                          <span class="hl opt">(</span><span class="hl kwa">sb-thread</span><span class="hl opt">::</span>thread-os-thread thread<span class="hl opt">)</span>
                          <span class="hl num">16</span>
                          <span class="hl opt">(</span><span class="hl kwa">cast</span> alien-cpuset <span class="hl opt">(*</span> unsigned-char<span class="hl opt">))))))</span>

<span class="hl opt">(</span><span class="hl kwa">defun</span> apic-core-map <span class="hl opt">(</span><span class="hl kwa">cpuset-list</span><span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">let</span> <span class="hl opt">((</span><span class="hl kwa">default-map</span> <span class="hl opt">(</span><span class="hl kwa">mapcar</span> <span class="hl opt">#'</span>list cpuset-list cpuset-list<span class="hl opt">)))</span>
    <span class="hl opt">(</span><span class="hl kwa">unless</span> <span class="hl opt">(</span><span class="hl kwa">probe-file</span> <span class="hl opt">#</span>p<span class="hl str">&quot;/proc/cpuinfo&quot;</span><span class="hl opt">)</span>
      <span class="hl opt">(</span><span class="hl kwa">return-from</span> apic-core-map default-map<span class="hl opt">))</span>
    <span class="hl opt">(</span><span class="hl kwa">with-open-file</span> <span class="hl opt">(</span><span class="hl kwa">cpuinfo</span> <span class="hl opt">#</span>p<span class="hl str">&quot;/proc/cpuinfo&quot;</span><span class="hl opt">)</span>
      <span class="hl opt">(</span><span class="hl kwa">flet</span> <span class="hl opt">((</span><span class="hl kwa">parse-key-value</span> <span class="hl opt">(</span><span class="hl kwa">line</span> key<span class="hl opt">)</span>
               <span class="hl opt">(</span><span class="hl kwa">when</span> <span class="hl opt">(</span><span class="hl kwa">and</span> <span class="hl opt">(&gt; (</span><span class="hl kwa">length</span> line<span class="hl opt">) (</span><span class="hl kwa">length</span> key<span class="hl opt">))</span>
                          <span class="hl opt">(</span><span class="hl kwa">string</span><span class="hl opt">=</span> line key <span class="hl opt">:</span>end1 <span class="hl opt">(</span><span class="hl kwa">length</span> key<span class="hl opt">)))</span>
                 <span class="hl opt">(</span><span class="hl kwa">let</span> <span class="hl opt">((</span><span class="hl kwa">value-offset</span> <span class="hl opt">(</span><span class="hl kwa">position</span> <span class="hl opt">#</span>\<span class="hl opt">:</span> line <span class="hl opt">:</span>start <span class="hl opt">(</span><span class="hl kwa">length</span> key<span class="hl opt">))))</span>
                   <span class="hl opt">(</span><span class="hl kwa">when</span> value-offset
                     <span class="hl opt">(</span><span class="hl kwa">parse-integer</span> line <span class="hl opt">:</span>start <span class="hl opt">(</span><span class="hl kwa">1</span><span class="hl opt">+</span> value-offset<span class="hl opt">) :</span>junk-allowed t<span class="hl opt">))))))</span>
        <span class="hl opt">(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>with current-cpu <span class="hl opt">=</span> nil
           <span class="hl opt">:</span>for line <span class="hl opt">= (</span><span class="hl kwa">read-line</span> cpuinfo nil nil<span class="hl opt">)</span>
           <span class="hl opt">:</span>while line
           <span class="hl opt">:</span>do <span class="hl opt">(</span><span class="hl kwa">multiple-value-bind</span> <span class="hl opt">(</span><span class="hl kwa">processor</span> apicid<span class="hl opt">)</span>
                   <span class="hl opt">(</span><span class="hl kwa">values</span> <span class="hl opt">(</span><span class="hl kwa">parse-key-value</span> line <span class="hl str">&quot;processor&quot;</span><span class="hl opt">)</span>
                           <span class="hl opt">(</span><span class="hl kwa">parse-key-value</span> line <span class="hl str">&quot;apicid&quot;</span><span class="hl opt">))</span>
                 <span class="hl opt">(</span><span class="hl kwa">cond</span> <span class="hl opt">((</span><span class="hl kwa">and</span> current-cpu apicid<span class="hl opt">) (</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">first</span> <span class="hl opt">(</span><span class="hl kwa">find</span> current-cpu default-map <span class="hl opt">:</span>key <span class="hl opt">#'</span>second<span class="hl opt">))</span> apicid
                                                       current-cpu nil<span class="hl opt">))</span>
                       <span class="hl opt">(</span><span class="hl kwa">processor</span> <span class="hl opt">(</span><span class="hl kwa">setf</span> current-cpu processor<span class="hl opt">))))</span>
           <span class="hl opt">:</span>finally <span class="hl opt">(</span><span class="hl kwa">return</span> <span class="hl opt">(</span><span class="hl kwa">sort</span> default-map <span class="hl opt">#'&lt; :</span>key <span class="hl opt">#'</span>first<span class="hl opt">)))))))</span>
  

<span class="hl opt">(</span><span class="hl kwa">defpackage</span> <span class="hl opt">#:</span>chameneos-redux
  <span class="hl opt">(:</span>use <span class="hl opt">:</span>cl <span class="hl opt">:</span>smp-utils<span class="hl opt">))</span>

<span class="hl opt">(</span><span class="hl kwa">in-package</span> <span class="hl opt">:</span>chameneos-redux<span class="hl opt">)</span>

<span class="hl slc">;;</span>
<span class="hl slc">;; Game DSL compiler</span>
<span class="hl slc">;;</span>

<span class="hl opt">(</span><span class="hl kwa">defmacro</span> declare-colors-map <span class="hl opt">(&amp;</span>rest transformations<span class="hl opt">)</span>
  <span class="hl opt">`(</span><span class="hl kwa">progn</span>
     <span class="hl opt">(</span><span class="hl kwa">defun</span> complement-color <span class="hl opt">(</span><span class="hl kwa">color-a</span> color-b<span class="hl opt">)</span>
       <span class="hl opt">(</span><span class="hl kwa">cond</span>
         <span class="hl opt">,&#64;(</span><span class="hl kwa">loop</span>
              <span class="hl opt">:</span>for <span class="hl opt">(</span><span class="hl kwa">test-a</span> kw-plus test-b kw-arrow test-result<span class="hl opt">) :</span>in transformations
              <span class="hl opt">:</span>do <span class="hl opt">(</span><span class="hl kwa">assert</span> <span class="hl opt">(</span><span class="hl kwa">and</span> <span class="hl opt">(</span><span class="hl kwa">eq</span> kw-plus <span class="hl opt">'+) (</span><span class="hl kwa">eq</span> kw-arrow <span class="hl opt">'</span>-<span class="hl opt">&gt;)))</span>
              <span class="hl opt">:</span>collect <span class="hl opt">`((</span><span class="hl kwa">and</span> <span class="hl opt">(</span><span class="hl kwa">eq</span> color-a <span class="hl opt">',</span>test-a<span class="hl opt">) (</span><span class="hl kwa">eq</span> color-b <span class="hl opt">',</span>test-b<span class="hl opt">))</span>
                         <span class="hl opt">',</span>test-result<span class="hl opt">))</span>
         <span class="hl opt">(</span><span class="hl kwa">t</span> <span class="hl opt">(</span><span class="hl kwa">error</span> <span class="hl str">&quot;Invalid colors combinations&quot;</span><span class="hl opt">))))</span>
     <span class="hl opt">(</span><span class="hl kwa">defun</span> print-colors <span class="hl opt">()</span>
       <span class="hl opt">(</span><span class="hl kwa">format</span> t <span class="hl str">&quot;玺狺}%&quot;</span>
               <span class="hl opt">(</span><span class="hl kwa">list</span> <span class="hl opt">,&#64;(</span><span class="hl kwa">loop</span>
                          <span class="hl opt">:</span>for <span class="hl opt">(</span><span class="hl kwa">test-a</span> kw-plus test-b<span class="hl opt">) :</span>in transformations
                          <span class="hl opt">:</span>collect <span class="hl opt">`(</span><span class="hl kwa">list</span> <span class="hl opt">,(</span><span class="hl kwa">string-downcase</span> <span class="hl opt">(</span><span class="hl kwa">string</span> test-a<span class="hl opt">))</span>
                                          <span class="hl opt">,(</span><span class="hl kwa">string-downcase</span> <span class="hl opt">(</span><span class="hl kwa">string</span> test-b<span class="hl opt">))</span>
                                          <span class="hl opt">(</span><span class="hl kwa">string-downcase</span>
                                           <span class="hl opt">(</span><span class="hl kwa">string</span> <span class="hl opt">(</span><span class="hl kwa">complement-color</span> <span class="hl opt">',</span>test-a
                                                                     <span class="hl opt">',</span>test-b<span class="hl opt">))))))))))</span>

<span class="hl opt">(</span><span class="hl kwa">defun</span> spell-number <span class="hl opt">(</span><span class="hl kwa">number</span><span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">with-output-to-string</span> <span class="hl opt">(</span><span class="hl kwa">result-string</span><span class="hl opt">)</span>
    <span class="hl opt">(</span><span class="hl kwa">loop</span>
       <span class="hl opt">:</span>for char <span class="hl opt">:</span>across <span class="hl opt">(</span><span class="hl kwa">the</span> simple-string <span class="hl opt">(</span><span class="hl kwa">format</span> nil <span class="hl str">&quot;a&quot;</span> number<span class="hl opt">))</span>
       <span class="hl opt">:</span>do <span class="hl opt">(</span><span class="hl kwa">format</span> result-string <span class="hl str">&quot; r&quot;</span> <span class="hl opt">(</span><span class="hl kwa">-</span> <span class="hl opt">(</span><span class="hl kwa">char-code</span> char<span class="hl opt">) (</span><span class="hl kwa">char-code</span> <span class="hl opt">#</span>\<span class="hl num">0</span><span class="hl opt">))))))</span>

<span class="hl opt">(</span><span class="hl kwa">defmacro</span> spin-wait <span class="hl opt">(</span><span class="hl kwa">condition</span> <span class="hl opt">&amp;</span>key no-spin<span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">let</span> <span class="hl opt">((</span><span class="hl kwa">yield-spin</span> <span class="hl opt">`(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>until <span class="hl opt">,</span>condition <span class="hl opt">:</span>do <span class="hl opt">(</span><span class="hl kwa">sb-thread</span><span class="hl opt">:</span>thread-yield<span class="hl opt">))))</span>
    <span class="hl opt">(</span><span class="hl kwa">if</span> no-spin
        yield-spin
        <span class="hl opt">`(</span><span class="hl kwa">loop</span>
            <span class="hl opt">:</span>repeat <span class="hl num">16384</span>
            <span class="hl opt">:</span>do <span class="hl opt">(</span><span class="hl kwa">when</span> <span class="hl opt">,</span>condition
                  <span class="hl opt">(</span><span class="hl kwa">return</span><span class="hl opt">))</span>
            <span class="hl opt">:</span>finally <span class="hl opt">,</span>yield-spin<span class="hl opt">))))</span>

<span class="hl opt">(</span><span class="hl kwa">defstruct</span> chameneo
  <span class="hl opt">(</span><span class="hl kwa">color</span> <span class="hl opt">'</span>none <span class="hl opt">:</span>type symbol<span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">meet-count</span> <span class="hl num">0</span> <span class="hl opt">:</span>type fixnum<span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">same-count</span> <span class="hl num">0</span> <span class="hl opt">:</span>type fixnum<span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">meet-wait</span> nil <span class="hl opt">:</span>type boolean<span class="hl opt">))</span>

<span class="hl opt">(</span><span class="hl kwa">defmacro</span> with-games <span class="hl opt">((&amp;</span>rest descriptions<span class="hl opt">) &amp;</span>body body<span class="hl opt">)</span>
  <span class="hl opt">(</span><span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwa">null</span> descriptions<span class="hl opt">)</span>
      <span class="hl opt">`(</span><span class="hl kwa">progn</span> <span class="hl opt">,&#64;</span>body<span class="hl opt">)</span>
      <span class="hl opt">(</span><span class="hl kwa">destructuring-bind</span> <span class="hl opt">(</span><span class="hl kwa">game-name</span> <span class="hl opt">&amp;</span>rest colors<span class="hl opt">)</span>
          <span class="hl opt">(</span><span class="hl kwa">car</span> descriptions<span class="hl opt">)</span>
        <span class="hl opt">(</span><span class="hl kwa">let</span><span class="hl opt">* ((</span><span class="hl kwa">colors-count</span> <span class="hl opt">(</span><span class="hl kwa">length</span> colors<span class="hl opt">))</span>
               <span class="hl opt">(</span><span class="hl kwa">worker-binds</span> <span class="hl opt">(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>repeat colors-count <span class="hl opt">:</span>collect <span class="hl opt">(</span><span class="hl kwa">gensym</span><span class="hl opt">)))</span>
               <span class="hl opt">(</span><span class="hl kwa">chameneos</span> <span class="hl opt">(</span><span class="hl kwa">gensym</span> <span class="hl str">&quot;CHAMENEOS&quot;</span><span class="hl opt">))</span>
               <span class="hl opt">(</span><span class="hl kwa">action-cas</span> <span class="hl opt">(</span><span class="hl kwa">gensym</span> <span class="hl str">&quot;ACTION-CAS&quot;</span><span class="hl opt">)))</span>
          <span class="hl opt">`(</span><span class="hl kwa">let</span> <span class="hl opt">((,</span>chameneos <span class="hl opt">(</span><span class="hl kwa">coerce</span> <span class="hl opt">(</span><span class="hl kwa">list</span> <span class="hl opt">,&#64;(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>repeat colors-count <span class="hl opt">:</span>collect <span class="hl opt">`(</span><span class="hl kwa">make-chameneo</span><span class="hl opt">)))</span>
                                     <span class="hl opt">'</span>simple-vector<span class="hl opt">))</span>
                 <span class="hl opt">(,</span>action-cas <span class="hl opt">(</span><span class="hl kwa">list</span> <span class="hl num">0</span><span class="hl opt">))</span>
                 <span class="hl opt">,&#64;</span>worker-binds<span class="hl opt">)</span>
             <span class="hl opt">(</span><span class="hl kwa">declare</span> <span class="hl opt">(</span><span class="hl kwa">type</span> <span class="hl opt">(</span><span class="hl kwa">simple-vector</span> <span class="hl opt">,</span>colors-count<span class="hl opt">) ,</span>chameneos<span class="hl opt">)</span>
                      <span class="hl opt">(</span><span class="hl kwa">type</span> cons <span class="hl opt">,</span>action-cas<span class="hl opt">)</span>
                      <span class="hl opt">(</span><span class="hl kwa">type</span> <span class="hl opt">(</span><span class="hl kwa">or</span> null sb-thread<span class="hl opt">:</span>thread<span class="hl opt">) ,&#64;</span>worker-binds<span class="hl opt">))</span>
             <span class="hl opt">(</span><span class="hl kwa">flet</span> <span class="hl opt">((,(</span><span class="hl kwa">intern</span> <span class="hl opt">(</span><span class="hl kwa">format</span> nil <span class="hl str">&quot;RUN-a&quot;</span> game-name<span class="hl opt">)) (</span><span class="hl kwa">count</span> threads-affinity smp-p<span class="hl opt">)</span>
                      <span class="hl opt">(</span><span class="hl kwa">declare</span> <span class="hl opt">(</span><span class="hl kwa">type</span> fixnum count<span class="hl opt">) (</span><span class="hl kwa">type</span> list threads-affinity<span class="hl opt">) (</span><span class="hl kwa">type</span> boolean smp-p<span class="hl opt">))</span>
                      <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">car</span> <span class="hl opt">,</span>action-cas<span class="hl opt">) (</span><span class="hl kwa">the</span> fixnum <span class="hl opt">(</span><span class="hl kwa">ash</span> count <span class="hl opt">,(</span><span class="hl kwa">integer-length</span> <span class="hl opt">(</span><span class="hl kwa">1</span><span class="hl opt">+</span> colors-count<span class="hl opt">)))))</span>
                      <span class="hl opt">(</span><span class="hl kwa">flet</span> <span class="hl opt">((</span><span class="hl kwa">color-worker</span> <span class="hl opt">(</span><span class="hl kwa">id</span> color<span class="hl opt">)</span>
                               <span class="hl opt">(</span><span class="hl kwa">declare</span> <span class="hl opt">(</span><span class="hl kwa">type</span> <span class="hl opt">(</span><span class="hl kwa">integer</span> <span class="hl num">0</span> <span class="hl opt">,(</span><span class="hl kwa">1-</span> colors-count<span class="hl opt">))</span> id<span class="hl opt">) (</span><span class="hl kwa">type</span> symbol color<span class="hl opt">))</span>
                               <span class="hl opt">(</span><span class="hl kwa">lambda</span> <span class="hl opt">()</span>
                                 <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">affinity</span> sb-thread<span class="hl opt">:*</span>current-thread<span class="hl opt">*)</span> threads-affinity<span class="hl opt">)</span>
                                 <span class="hl opt">(</span><span class="hl kwa">let</span> <span class="hl opt">((</span><span class="hl kwa">state</span> <span class="hl opt">(</span><span class="hl kwa">car</span> <span class="hl opt">,</span>action-cas<span class="hl opt">))</span>
                                       <span class="hl opt">(</span><span class="hl kwa">self</span> <span class="hl opt">(</span><span class="hl kwa">elt</span> <span class="hl opt">,</span>chameneos id<span class="hl opt">)))</span>
                                   <span class="hl opt">(</span><span class="hl kwa">declare</span> <span class="hl opt">(</span><span class="hl kwa">type</span> <span class="hl opt">(</span><span class="hl kwa">integer</span> <span class="hl num">0</span> <span class="hl opt">,</span>most-positive-fixnum<span class="hl opt">)</span> state<span class="hl opt">)</span>
                                            <span class="hl opt">(</span><span class="hl kwa">type</span> chameneo self<span class="hl opt">))</span>
                                   <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-color</span> self<span class="hl opt">)</span> color<span class="hl opt">)</span>
                                   <span class="hl opt">(</span><span class="hl kwa">loop</span>
                                      <span class="hl opt">(</span><span class="hl kwa">when</span> <span class="hl opt">(</span><span class="hl kwa">zerop</span> state<span class="hl opt">)</span>
                                        <span class="hl opt">(</span><span class="hl kwa">return</span><span class="hl opt">))</span>
                                      <span class="hl opt">(</span><span class="hl kwa">let</span><span class="hl opt">* ((</span><span class="hl kwa">peer-id</span> <span class="hl opt">(</span><span class="hl kwa">logand</span> state <span class="hl opt">,(</span><span class="hl kwa">1-</span> <span class="hl opt">(</span><span class="hl kwa">ash</span> <span class="hl num">1</span> <span class="hl opt">(</span><span class="hl kwa">integer-length</span> <span class="hl opt">(</span><span class="hl kwa">1</span><span class="hl opt">+</span> colors-count<span class="hl opt">))))))</span>
                                             <span class="hl opt">(</span><span class="hl kwa">new-state</span> <span class="hl opt">(</span><span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwa">zerop</span> peer-id<span class="hl opt">)</span>
                                                            <span class="hl opt">(</span><span class="hl kwa">logior</span> state <span class="hl opt">(</span><span class="hl kwa">1</span><span class="hl opt">+</span> id<span class="hl opt">))</span>
                                                            <span class="hl opt">(</span><span class="hl kwa">-</span> state peer-id <span class="hl opt">,(</span><span class="hl kwa">ash</span> <span class="hl num">1</span> <span class="hl opt">(</span><span class="hl kwa">integer-length</span> <span class="hl opt">(</span><span class="hl kwa">1</span><span class="hl opt">+</span> colors-count<span class="hl opt">)))))))</span>
                                        <span class="hl opt">(</span><span class="hl kwa">declare</span> <span class="hl opt">(</span><span class="hl kwa">type</span> <span class="hl opt">(</span><span class="hl kwa">integer</span> <span class="hl num">0</span> <span class="hl opt">,(</span><span class="hl kwa">1</span><span class="hl opt">+</span> colors-count<span class="hl opt">))</span> peer-id<span class="hl opt">)</span>
                                                 <span class="hl opt">(</span><span class="hl kwa">type</span> <span class="hl opt">(</span><span class="hl kwa">integer</span> <span class="hl num">0</span> <span class="hl opt">,</span>most-positive-fixnum<span class="hl opt">)</span> new-state<span class="hl opt">))</span>
                                        <span class="hl opt">(</span><span class="hl kwa">let</span> <span class="hl opt">((</span><span class="hl kwa">prev-state</span> <span class="hl opt">(</span><span class="hl kwa">sb-ext</span><span class="hl opt">:</span>compare-and-swap <span class="hl opt">(</span><span class="hl kwa">car</span> <span class="hl opt">,</span>action-cas<span class="hl opt">)</span> state new-state<span class="hl opt">)))</span>
                                          <span class="hl opt">(</span><span class="hl kwa">declare</span> <span class="hl opt">(</span><span class="hl kwa">type</span> <span class="hl opt">(</span><span class="hl kwa">integer</span> <span class="hl num">0</span> <span class="hl opt">,</span>most-positive-fixnum<span class="hl opt">)</span> prev-state<span class="hl opt">))</span>
                                          <span class="hl opt">(</span><span class="hl kwa">if</span> <span class="hl opt">(=</span> prev-state state<span class="hl opt">)</span>
                                              <span class="hl opt">(</span><span class="hl kwa">progn</span> 
                                                <span class="hl opt">(</span><span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwa">zerop</span> peer-id<span class="hl opt">)</span>
                                                    <span class="hl opt">(</span><span class="hl kwa">progn</span>
                                                      <span class="hl opt">(</span><span class="hl kwa">if</span> smp-p
                                                          <span class="hl opt">(</span><span class="hl kwa">spin-wait</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-meet-wait</span> self<span class="hl opt">))</span>
                                                          <span class="hl opt">(</span><span class="hl kwa">spin-wait</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-meet-wait</span> self<span class="hl opt">) :</span>no-spin t<span class="hl opt">))</span>
                                                      <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-meet-wait</span> self<span class="hl opt">)</span> nil<span class="hl opt">))</span>
                                                    <span class="hl opt">(</span><span class="hl kwa">let</span> <span class="hl opt">((</span><span class="hl kwa">peer</span> <span class="hl opt">(</span><span class="hl kwa">elt</span> <span class="hl opt">,</span>chameneos <span class="hl opt">(</span><span class="hl kwa">1-</span> peer-id<span class="hl opt">))))</span>
                                                      <span class="hl opt">(</span><span class="hl kwa">when</span> <span class="hl opt">(=</span> id <span class="hl opt">(</span><span class="hl kwa">1-</span> peer-id<span class="hl opt">))</span>
                                                        <span class="hl opt">(</span><span class="hl kwa">incf</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-same-count</span> self<span class="hl opt">))</span>
                                                        <span class="hl opt">(</span><span class="hl kwa">incf</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-same-count</span> peer<span class="hl opt">)))</span>
                                                      <span class="hl opt">(</span><span class="hl kwa">let</span> <span class="hl opt">((</span><span class="hl kwa">new-color</span> <span class="hl opt">(</span><span class="hl kwa">complement-color</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-color</span> self<span class="hl opt">)</span>
                                                                                         <span class="hl opt">(</span><span class="hl kwa">chameneo-color</span> peer<span class="hl opt">))))</span>
                                                        <span class="hl opt">(</span><span class="hl kwa">declare</span> <span class="hl opt">(</span><span class="hl kwa">type</span> symbol new-color<span class="hl opt">))</span>
                                                        <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-color</span> self<span class="hl opt">)</span> new-color
                                                              <span class="hl opt">(</span><span class="hl kwa">chameneo-color</span> peer<span class="hl opt">)</span> new-color<span class="hl opt">)</span>
                                                        <span class="hl opt">(</span><span class="hl kwa">incf</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-meet-count</span> self<span class="hl opt">))</span>
                                                        <span class="hl opt">(</span><span class="hl kwa">incf</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-meet-count</span> peer<span class="hl opt">))</span>
                                                        <span class="hl opt">(</span><span class="hl kwa">setf</span> <span class="hl opt">(</span><span class="hl kwa">chameneo-meet-wait</span> peer<span class="hl opt">)</span> t<span class="hl opt">))))</span>
                                                <span class="hl opt">(</span><span class="hl kwa">setf</span> state <span class="hl opt">(</span><span class="hl kwa">car</span> <span class="hl opt">,</span>action-cas<span class="hl opt">)))</span>
                                              <span class="hl opt">(</span><span class="hl kwa">setf</span> state prev-state<span class="hl opt">)))))))))</span>
                        <span class="hl opt">,&#64;(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>for color <span class="hl opt">:</span>in colors <span class="hl opt">:</span>for thread-index <span class="hl opt">:</span>from <span class="hl num">0</span>
                             <span class="hl opt">:</span>collect <span class="hl opt">`(</span><span class="hl kwa">setf</span> <span class="hl opt">,(</span><span class="hl kwa">elt</span> worker-binds thread-index<span class="hl opt">)</span>
                                             <span class="hl opt">(</span><span class="hl kwa">sb-thread</span><span class="hl opt">:</span>make-thread <span class="hl opt">(</span><span class="hl kwa">color-worker</span> <span class="hl opt">,</span>thread-index <span class="hl opt">',</span>color<span class="hl opt">)</span>
                                                                    <span class="hl opt">:</span>name <span class="hl opt">,(</span><span class="hl kwa">format</span> nil <span class="hl str">&quot;chameneos-worker-a-a/a&quot;</span>
                                                                                   <span class="hl opt">(</span><span class="hl kwa">string-downcase</span> <span class="hl opt">(</span><span class="hl kwa">string</span> color<span class="hl opt">))</span>
                                                                                   thread-index
                                                                                   colors-count<span class="hl opt">)))))</span>
                      nil<span class="hl opt">)</span>
                    <span class="hl opt">(,(</span><span class="hl kwa">intern</span> <span class="hl opt">(</span><span class="hl kwa">format</span> nil <span class="hl str">&quot;WAIT-a&quot;</span> game-name<span class="hl opt">)) ()</span>
                      <span class="hl opt">,&#64;(</span><span class="hl kwa">loop</span> <span class="hl opt">:</span>for i <span class="hl opt">:</span>from <span class="hl num">0</span> <span class="hl opt">:</span>below colors-count <span class="hl opt">:</span>collect <span class="hl opt">`(</span><span class="hl kwa">sb-thread</span><span class="hl opt">:</span>join-thread <span class="hl opt">,(</span><span class="hl kwa">elt</span> worker-binds i<span class="hl opt">)))</span>
                      <span class="hl opt">(</span><span class="hl kwa">format</span> t <span class="hl opt">,(</span><span class="hl kwa">format</span> nil <span class="hl str">&quot;狺ウ聃雉患箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄眷镲鸺箴犷俭疳沆狍蠼㈣镳簪竞集箴犷炬矧泔祜俭疳沆狍蠼㈣镳簪竞集箴犷鹃泔祜蝮俭疳沆狍蠼㈣镳簪竞集箴犷俱镬戾泗俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔趄轭绛滹黝汜箦集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔趄轭缂箴犷泔祜蚣箴犷沆狍蠼㈣镳簪京┅┅集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄眷镲鸺箴犷俭疳沆狍蠼㈣镳簪竞集箴犷炬矧俭疳沆狍蠼㈣镳簪竞集箴犷炬蝻俭疳沆狍蠼㈣铛恝景集箴犷俭疳沆狍蠼㈣镳簪竞集箴犷锯屐秣俭疳沆狍蠼㈣镳簪粳集箴犷俱镬矧蟓泔躅俭疳沆狍蠼㈣镳簪竞集箴犷倔蹴黹铉俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄俱栳礤铄锃礤弭泔躅艏箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄惧祠集箴犷俭疳沆狍蠼㈣镳簪粳集箴犷俱栳礤铄矬榧箴犷沆狍蠼㈣镳簪京杭箴犷鹃铘麸翎俭疳沆狍蠼㈣镳簪竞集箴犷撅姝豉疱骈铛俭疳沆狍蠼㈣镳簪竞集箴犷句俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄炬矧磲艏箴犷俭疳沆狍蠼㈣篝颌睛聃雉箕狺狺ウ聃雉患箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄俱栳礤铄锃礤弭泔躅艏箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄惧祠集箴犷俭疳沆狍蠼㈣镳簪粳集箴犷俱栳礤铄矬榧箴犷沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔疱祆铛礅弪集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄俱栳礤铄锃筢礤泔躅艏箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄惧祠集箴犷俭疳沆狍蠼㈣镳簪粳集箴犷俱栳礤铄矬榧箴犷沆狍蠼㈣镳簪京┅┘箴犷俭疳沆狍蠼㈣镳簪竞集箴犷炬轭犰禊俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄炬矧磲艏箴犷俭疳沆狍蠼㈣篝颌睛聃雉箕狺ウ聃雉患箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔疱祆铛礅弪集箴犷麸翎旒箴犷沆狍蠼㈣镳簪京┅┅集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄诀轸璀玑礤蠹箴犷俭疳沆狍蠼㈣镳簪鲸Γ洞花集箴犷炯箴犷沆狍蠼㈣膑幄俱潋集箴犷溴筱蜷痿轱铙俭疳沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪粳Γ洞患箴犷锯镤俭疳沆狍蠼㈣镳簪京┅┅┅集箴犷俭疳沆狍蠼㈣箪恽净患箴犷俭疳沆狍蠼㈣箪恽净轻礤泔铘孱趔集箴犷俭疳沆狍蠼㈣箪恽净患箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄攫蝻珙集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄句邈灬蝈泔祜蝮磲鸺箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄锯祯寮箴犷俭疳沆狍蠼㈣镳簪精集箴犷忪蹂俭疳沆狍蠼㈣镳簪睛玺患箴犷忪蹂俭疳沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄锯祯寮箴犷俭疳沆狍蠼㈣镳簪精集箴犷蝈俭疳沆狍蠼㈣镳簪睛玺患箴犷屐祜骷箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄锯祯寮箴犷俭疳沆狍蠼㈣镳簪精集箴犷屐祜俭疳沆狍蠼㈣镳簪睛玺患箴犷蝈浼箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄掘邃集箴犷俭疳沆狍蠼㈣镳簪精集箴犷忪蹂俭疳沆狍蠼㈣镳簪睛玺患箴犷屐祜骷箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄掘邃集箴犷俭疳沆狍蠼㈣镳簪精集箴犷蝈俭疳沆狍蠼㈣镳簪睛玺患箴犷蝈浼箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄掘邃集箴犷俭疳沆狍蠼㈣镳簪精集箴犷屐祜俭疳沆狍蠼㈣镳簪睛玺患箴犷忪蹂俭疳沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄均屐祜骷箴犷俭疳沆狍蠼㈣镳簪精集箴犷忪蹂俭疳沆狍蠼㈣镳簪睛玺患箴犷蝈浼箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄均屐祜骷箴犷俭疳沆狍蠼㈣镳簪精集箴犷蝈俭疳沆狍蠼㈣镳簪睛玺患箴犷忪蹂俭疳沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄均屐祜骷箴犷俭疳沆狍蠼㈣镳簪精集箴犷屐祜俭疳沆狍蠼㈣镳簪睛玺患箴犷屐祜骷箴犷沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄句彐躅集箴犷蝓瞽玑礤俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄俱秕铘集箴犷沲蝌孱舡徭骈铋豉俭疳沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄句邈灬蝈集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄撅痿轫辁寮箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔疱邃集箴犷俭疳沆狍蠼㈣铛恝境集箴犷炯箴犷沆狍蠼㈣镳簪京集箴犷炯箴犷沆狍蠼㈣膑幄倔徭弭集箴犷俭疳沆狍蠼㈣铛恝景集箴犷炯箴犷沆狍蠼㈣镳簪京集箴犷炯箴犷沆狍蠼㈣膑幄句邂蹒集箴犷俭疳沆狍蠼㈣铛恝景集箴犷炯箴犷沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄爵疱集箴犷骈铛泔躅艏箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄爵疱集箴犷扉篝沲蝌孱舡徭骈铋豉俭疳沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄眷弭集箴犷炯箴犷沆狍蠼㈣镳簪惊è集箴犷炯箴犷沆狍蠼㈣膑幄踞泗轹瀛泔蝈蠹箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄眷孱玺杓箴犷沲蝌孱舡徭骈铋豉俭疳沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔眇鸺箴犷俭疳沆狍蠼㈣镳簪鲸玺患箴犷徙糸鲥泔蝈俭疳沆狍蠼㈣铛恝颈集箴犷炯箴犷沆狍蠼㈣镳簪京┅集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄诀轸璀玑礤蠹箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄剧犴瀛峒箴犷忪蹂蝈屐祜骷箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄剧犴瀛饧箴犷忪蹂蝈屐祜蝈屐祜忪蹂蝈屐祜蝈忪蹂俭疳沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄鹃婕箴犷箜瓠俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄卷蹯糸痨瀛鲠祯瀛忾钿集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄踞骀轭轸峒箴犷徭骈铋豉饧箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄鹃婕箴犷俭疳沆狍蠼㈣镳簪鲸祠患箴犷徙糸鲥泔蝈俭疳沆狍蠼㈣铛恝敬集箴犷炯箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄决犰蹂蠹箴犷沲蝌孱舡徭骈铋豉沲蝌孱舡徭骈铋豉俭疳沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄眷弭集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄踞痖悱磲鸺箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄踞痖悱泔蝈磲鸺箴犷沲蝌孱舡徭骈铋豉俭疳沆狍蠼㈣镳簪京┅集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄句邈灬蝈集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄爵疱集箴犷扉篝狃殂磲鸺箴犷沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄决犰蹂蠹箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄眷轶艏箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔邈镱浼箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄惧祠集箴犷狃殂磲俭疳沆狍蠼㈣铛恝景集箴犷炯箴犷沆狍蠼㈣镳簪京集箴犷炯箴犷沆狍蠼㈣膑幄倔邈镱浼箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄惧祠集箴犷狃殂磲俭疳沆狍蠼㈣铛恝颈集箴犷炯箴犷沆狍蠼㈣镳簪京┅集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄眷轶艏箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔邈镱浼箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄惧祠集箴犷狃殂磲俭疳沆狍蠼㈣铛恝静集箴犷炯箴犷沆狍蠼㈣镳簪京集箴犷炯箴犷沆狍蠼㈣膑幄倔邈镱浼箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄惧祠集箴犷狃殂磲俭疳沆狍蠼㈣铛恝境集箴犷炯箴犷沆狍蠼㈣镳簪京┅┅┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄掘躅玑礤峒箴犷泔躅徭骈铋豉箜瓠鸺箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄掘躅玑礤饧箴犷泔躅徭骈铋豉箜瓠鸺箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄诀衢舡玑礤峒箴犷炯箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄诀衢舡玑礤饧箴犷炯箴犷沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄攫蝻珙集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄掘躅玑礤峒箴犷泔躅沲蝌孱舡徭骈铋豉箜瓠鸺箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄诀衢舡玑礤峒箴犷炯箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄掘躅玑礤饧箴犷泔躅沲蝌孱舡徭骈铋豉箜瓠鸺箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄诀衢舡玑礤饧箴犷炯箴犷沆狍蠼㈣镳簪京┅┅┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄句彐躅集箴犷磲轭俭疳沆狍蠼㈣镳簪鲸犴鸹集箴犷撅痿轱钺骘蜚瀛泔躅艏箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄眷弭集箴犷炯箴犷沆狍蠼㈣镳簪惊è集箴犷炯箴犷沆狍蠼㈣膑幄踞蜱蠹箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄俱潋集箴犷筲屮艏箴犷沆狍蠼㈣镳簪竞集箴犷攫矬轼狎琏俭疳沆狍蠼㈣镳簪惊┅集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄俱秕铘集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄撅蚣箴犷骘蜚瀛泔躅俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄鹃婕箴犷狎珞俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄攫狎箦轭翦珏蚣箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄俱狎集箴犷狎珞俭疳沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣铛恝径鞍集箴犷炯箴犷沆狍蠼㈣镳簪京┅┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄攫蜷铘泔祜蝮集箴犷炯箴犷沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄卷蹯糸痨瀛鲠祯瀛忾钿集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄倔蹉沐篌鸺箴犷沲蝌孱舡徭骈铋豉俭疳沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄踞骀轭轸集箴犷筲翳蝈徜俭疳沆狍蠼㈣镳簪竞集箴犷俱躜蝈铘翳蝈徜俭疳沆狍蠼㈣镳簪惊┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄觉铎弩蠹箴犷篚沣弩蟓俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄惧蝌矧集箴犷俭疳沆狍蠼㈣篝颌睛聃雉黄衢戾麸蝈趄殄鲥沲蝌孱翳蝈徜徭骈铋豉聃雉患箴犷炯箴犷沆狍蠼㈣镳簪京┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄掘躅玑礤蠹箴犷泔躅沲蝌孱舡徭骈铋豉俭疳沆狍蠼㈣镳簪京┅┅集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄鹃瞽疳汶徵寮箴犷俭疳沆狍蠼㈣镳簪竞集箴犷俱飙躞弪俭疳沆狍蠼㈣镳簪京集箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄句彐躅集箴犷磲轭俭疳沆狍蠼㈣镳簪鲸┘箴犷俭疳沆狍蠼㈣镳簪鲸集箴犷炯箴犷沆狍蠼㈣膑幄俱栳礤铄矬蝈漉集箴犷炯箴犷沆狍蠼㈣镳簪竞杭箴犷卷衢罴箴犷沆狍蠼㈣镳簪京┘箴犷